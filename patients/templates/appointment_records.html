<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LE Dental Clinic - Appointment Records</title>
    <link rel="stylesheet" href="appointment_record.css">
</head>
<body>
    <!-- ===== Sidebar Navigation ===== -->
    <aside class="sidebar collapsed" id="sidebar">
        <div class="sidebar-header">
            <span class="ehr-logo">LE Dental Clinic</span>
            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                <span id="sidebarToggleIcon">&#9776;</span>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="patient_dashboard.html" class="sidebar-link"><span>üè†</span> <span class="sidebar-text">Dashboard</span></a>
            <a href="#" class="sidebar-link"><span>üìÑ</span> <span class="sidebar-text">Health Records</span></a>
            <a href="appointment_records.html" class="sidebar-link active"><span>üìÖ</span> <span class="sidebar-text">Appointment Records</span></a>
            <a href="patient_profile.html" class="sidebar-link"><span>üë§</span> <span class="sidebar-text">Profile</span></a>
        </nav>
    </aside>

    <!-- ===== Main Dashboard Content ===== -->
    <div class="dashboard-content" id="dashboardContent">
        <!-- ===== Header with User Info ===== -->
        <header class="dashboard-header">
            <div class="dashboard-user">
                <img id="navbarAvatar" src="https://scontent.fmnl30-3.fna.fbcdn.net/v/t39.30808-6/469984245_3904115036572694_3646693016826261098_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=xdyaQbkjOhMQ7kNvwEZmkD3&_nc_oc=AdmsxP4klAV_wCHpzQ7e1JaOPJ4ZizGEsQ3yFW89XtgACT6xyslNpr2H6iQRUUHC-qw&_nc_zt=23&_nc_ht=scontent.fmnl30-3.fna&_nc_gid=fGB9mGtLdZ8dO7axjT7pWg&oh=00_AfPs91_CEwePyqV74c1NQnIvBvq8OJgK9W26xkkX9wVKdQ&oe=68490CC9" alt="Patient Avatar">
                <span>Hi, [Patient Name]!</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </header>
        <main class="dashboard-main">
            <label class="page-label" for="appointment-records-section">Appointment Records</label>
            <section class="appointment-records-section" id="appointment-records-section">
                <!-- ===== Tabs for Appointment Status ===== -->
                <div class="appointment-records-header">
                    <div class="appointment-records-tabs">
                        <button class="tab-btn active" data-tab="upcoming">Upcoming</button>
                        <button class="tab-btn" data-tab="past">Completed</button>
                        <button class="tab-btn" data-tab="rescheduled">Rescheduled</button>
                    </div>
                </div>
                <!-- ===== Upcoming Appointments ===== -->
                <div class="appointment-records-list" id="upcoming-appointments">
                    <div class="appointment-card upcoming">
                        <div class="appointment-info">
                            <span class="date">June 10, 2025</span>
                            <span class="time">10:00 AM</span>
                            <span class="doctor">Dr. Lhojen</span>
                            <span class="service">Service 1</span>
                        </div>
                        <div class="appointment-actions">
                            <span class="status upcoming">Upcoming</span>
                            <button class="cancel-btn" onclick="cancelAppointment(this)">Cancel</button>
                        </div>
                    </div>
                    <div class="appointment-card upcoming">
                        <div class="appointment-info">
                            <span class="date">June 10, 2025</span>
                            <span class="time">10:00 AM</span>
                            <span class="doctor">Dr. Adrian</span>
                            <span class="service">Service 2</span>
                        </div>
                        <div class="appointment-actions">
                            <span class="status upcoming">Upcoming</span>
                            <button class="cancel-btn" onclick="cancelAppointment(this)">Cancel</button>
                        </div>
                    </div>
                </div>
                <!-- ===== Past Appointments ===== -->
                <div class="appointment-records-list" id="past-appointments" style="display:none;">
                    <div class="appointment-card past">
                        <div class="appointment-info">
                            <span class="date">May 20, 2025</span>
                            <span class="time">9:00 AM</span>
                            <span class="doctor">Dr. Lhojen</span>
                            <span class="service">Service 1</span>
                        </div>
                        <div class="appointment-actions">
                            <span class="status past">Completed</span>
                            <button class="view-btn" onclick="viewAppointmentDetails(this)">View Details</button>
                        </div>
                    </div>
                    <div class="appointment-card past">
                        <div class="appointment-info">
                            <span class="date">May 5, 2025</span>
                            <span class="time">2:00 PM</span>
                            <span class="doctor">Dr. Adrian</span>
                            <span class="service">Service 2</span>
                        </div>
                        <div class="appointment-actions">
                            <span class="status past">Completed</span>
                            <button class="view-btn" onclick="viewAppointmentDetails(this)">View Details</button>
                        </div>
                    </div>
                </div>
                <!-- ===== Rescheduled Appointments ===== -->
                <div class="appointment-records-list" id="rescheduled-appointments" style="display:none;">
                    <div class="appointment-card rescheduled">
                        <div class="appointment-info">
                            <span class="date">June 3, 2025</span>
                            <span class="time">3:00 PM</span>
                            <span class="doctor">Dr. Lhojen</span>
                            <span class="service">Service 1</span>
                            <span class="resched-info" style="color:#059669;font-weight:600;">
                                Rescheduled from: May 30, 2025, 1:00 PM
                            </span>
                        </div>
                        <div class="appointment-actions">
                            <span class="status rescheduled" style="background:#fef9c3;color:#b45309;">Rescheduled</span>
                            <button class="cancel-btn" onclick="cancelAppointment(this)">Cancel</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ===== Appointment Details Modal ===== -->
    <div id="appointmentModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3>Appointment Details</h3>
            <div id="modalDetails">
                <!-- Details will be filled by JS -->
            </div>
        </div>
    </div>
    <!-- ===== Cancel Confirmation Modal ===== -->
    <div id="cancelModal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width:340px;text-align:center;">
            <span class="close-modal" onclick="closeCancelModal()">&times;</span>
            <h3>Cancel Appointment</h3>
            <p style="margin:1.5rem 0 2rem 0;">Are you sure you want to cancel your appointment?</p>
            <button class="cancel-btn" style="background:#ef4444;color:#fff;margin-right:1rem;" onclick="confirmCancelAppointment()">Yes, Cancel</button>
            <button class="view-btn" onclick="closeCancelModal()">No, Keep</button>
        </div>
    </div>
    <!-- ===== Reschedule Info Modal ===== -->
    <div id="reschedInfoModal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width:400px;text-align:center;">
            <span class="close-modal" onclick="closeReschedInfoModal()">&times;</span>
            <h3>Reschedule Information</h3>
            <div id="reschedInfoContent" style="margin:1.5rem 0 1rem 0; color:#059669; font-weight:600;">
                <!-- Reschedule info will be filled by JS -->
            </div>
            <button class="view-btn" onclick="closeReschedInfoModal()">Close</button>
        </div>
    </div>

    <!-- ===== Scripts ===== -->
     <script src="script1.js"></script>
    <script>
        // ===== Tab Switching Logic =====
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('upcoming-appointments').style.display = "none";
                document.getElementById('past-appointments').style.display = "none";
                document.getElementById('rescheduled-appointments').style.display = "none";
                if (this.dataset.tab === "upcoming") {
                    document.getElementById('upcoming-appointments').style.display = "block";
                } else if (this.dataset.tab === "past") {
                    document.getElementById('past-appointments').style.display = "block";
                } else if (this.dataset.tab === "rescheduled") {
                    document.getElementById('rescheduled-appointments').style.display = "block";
                }
            });
        });

        // ===== Cancel Appointment Logic =====
        let appointmentToCancel = null;
        function cancelAppointment(button) {
            appointmentToCancel = button.closest('.appointment-card');
            document.getElementById('cancelModal').style.display = 'flex';
        }
        function confirmCancelAppointment() {
            if (appointmentToCancel) {
                appointmentToCancel.parentNode.removeChild(appointmentToCancel);
                appointmentToCancel = null;
            }
            closeCancelModal();
        }
        function closeCancelModal() {
            document.getElementById('cancelModal').style.display = 'none';
            appointmentToCancel = null;
        }

        // ===== View Appointment Details Logic =====
        function viewAppointmentDetails(button) {
            // Get details from the card
            const card = button.closest('.appointment-card');
            const date = card.querySelector('.date').textContent;
            const time = card.querySelector('.time').textContent;
            const doctor = card.querySelector('.doctor').textContent;
            const service = card.querySelector('.service').textContent;

            // Example billing details (replace with real data as needed)
            const billing = {
                sub_1: 500,
                sub_2: 300,
                sub_3: 700
            };

            // Build billing items array dynamically
            let billingItems = [];
            let total = 0;

            // Dynamic billing logic based on service type
            // - If service is "Service 1", total = sub_1 + sub_2
            // - If service is "Service 2", total = sub_2 + sub_3
            // - If service is "Service 3", total = sub_1 + sub_3
            if (service === "Service 1") {
                billingItems.push({ label: "Sub 1 Price", amount: billing.sub_1 });
                billingItems.push({ label: "Sub 2 Fee", amount: billing.sub_2 });
            } else if (service === "Service 2") {
                billingItems.push({ label: "Sub 2 Fee", amount: billing.sub_2 });
                billingItems.push({ label: "Sub 3 Fee", amount: billing.sub_3 });
            } else if (service === "Service 3") {
                billingItems.push({ label: "Sub 1 Price", amount: billing.sub_1 });
                billingItems.push({ label: "Sub 3 Fee", amount: billing.sub_3 });
            } else {
                // Default: just show sub_1
                billingItems.push({ label: "Sub 1 Price", amount: billing.sub_1 });
            }

            // Calculate total dynamically
            total = billingItems.reduce((sum, item) => sum + item.amount, 0);

            // Build billing list HTML
            const billingListHtml = billingItems.map(item =>
                `<li><span>${item.label}</span> <span>‚Ç±${item.amount}</span></li>`
            ).join("");

            // Fill modal content
            document.getElementById('modalDetails').innerHTML = `
                <p><strong>Date:</strong> ${date}</p>
                <p><strong>Time:</strong> ${time}</p>
                <p><strong>Doctor:</strong> ${doctor}</p>
                <p><strong>Service:</strong> ${service}</p>
                <hr>
                <p><strong>Billing Details:</strong></p>
                <ul class="billing-list">
                    ${billingListHtml}
                </ul>
                <div class="billing-list-total"><strong>Total: ‚Ç±${total}</strong></div>
            `;
            document.getElementById('appointmentModal').style.display = 'flex';
        }
        function closeModal() {
            document.getElementById('appointmentModal').style.display = 'none';
        }

        // ===== Reschedule Info Modal Logic =====
        function showReschedInfo(button) {
            const card = button.closest('.appointment-card');
            const reschedInfo = card.querySelector('.resched-info');
            document.getElementById('reschedInfoContent').textContent = reschedInfo ? reschedInfo.textContent : "No reschedule information.";
            document.getElementById('reschedInfoModal').style.display = 'flex';
        }
        function closeReschedInfoModal() {
            document.getElementById('reschedInfoModal').style.display = 'none';
        }
    </script>
</body>
</html>